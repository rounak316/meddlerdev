import { Component, OnInit } from '@angular/core';
import * as Rx from 'rxjs/';

@Component({
  selector: 'app-code-editor',
  templateUrl: './code-editor.component.html',
  styleUrls: ['./code-editor.component.scss']
})
export class CodeEditorComponent implements OnInit {

  public editorContent: string = ''

  public options: Object = {
    placeholderText: 'Edit Your Content Here!',
    charCounterCount: true,
    autofocus: true,
    toolbarButtons: [
      'bold', 'italic','align','insertImage', 'insertVideo', 'embedly', 'insertFile','quote'
    ]
    ,
    saveURL: 'https://api.meddler.xyz/api/v1/writeUp',
    saveMethod: 'POST',
    saveInterval: 500,
    saveParam: 'writeUp',
    saveParams: {
      aId: '123213',
      uId: 'Prakhar '

    },

    heightMax: 500,

    requestHeaders: {
      
      'Auth-Action': 'VERIFY',
      'Auth-Identity': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NDM1MjEwNjgsImlhdCI6MTU0MjUyMTAzOCwibG9naW52aWEiOiJGSVJFQkFTRSIsIm5mYiI6MTU0MjUyMTA2OCwicmlkIjoiUGhvbmUgTnVtYmVyIiwic3ViIjoiIiwidWlkIjoiKzkxOTQyNTgxMzY3MCJ9.qmF797fgxdwl4UL0l3dV8z2f_QRu4cK4y9D-71wu550'
    },


    quickInsertButtons: [],
    quickInsertTags: [],
    toolbarBottom: true,
    toolbarVisibleWithoutSelection: false,
    toolbarInline: true,



    events : {
      'froalaEditor.contentChanged' :()=> this.onContentChanged()
    }
  }
  

  constructor() { }

  isContentChanged = false

  changeObserver = null

  onContentChanged() { 
    console.log("onContentChanged")
    this.isContentChanged = true
    this.onContentSaved()
  }

  onContentSaved() { 
   
    this.isContentChanged = false

  if(this.changeObserver != null )
      this.changeObserver.unsubscribe()

    this.changeObserver = Rx.Observable.timer(2000).take(1).subscribe( ()=>{
      console.log("onContentSaved")
  } )

  

}

  ngOnInit() {
  }

  saveToServer(){
    console.log("Burping")
    console.log(this.editorContent)
  }

}
